document.addEventListener("DOMContentLoaded",()=>{initTerminalSystem()});function initTerminalSystem(){let e={overlay:document.getElementById("terminal-overlay"),body:document.getElementById("terminal-body"),input:document.getElementById("terminal-input"),header:document.getElementById("terminal-header"),closeBtn:document.getElementById("close-terminal"),toggleBtn:document.getElementById("terminal-toggle"),canvas:document.getElementById("matrix-canvas")};if(!e.input||!e.body||document.getElementById("terminal-active-line"))return;e.input.parentElement?.removeChild(e.input),e.body.innerHTML="";let t=document.createElement("div");t.id="terminal-history",t.style.marginBottom="5px",t.style.width="100%",e.body.appendChild(t);let r=document.createElement("div");r.innerHTML='<span style="color:var(--term-gray);">System initialized. Type </span><span style="color:var(--term-text); font-weight:bold;">help</span><span style="color:var(--term-gray);"> to view available commands.</span><br><br>',t.appendChild(r);let n=document.createElement("div");n.id="terminal-active-line",n.style.display="flex",n.style.alignItems="center";let i=document.createElement("span");i.id="terminal-prompt-label",i.style.marginRight="8px",i.style.whiteSpace="nowrap",n.appendChild(i),n.appendChild(e.input),e.body.appendChild(n),e.input.style.flexGrow="1",e.input.style.border="none",e.input.style.background="transparent",e.input.style.color="var(--term-text)",e.input.style.outline="none",e.input.style.fontFamily="inherit",e.input.style.fontSize="inherit",e.input.style.padding="0",e.input.style.margin="0",e.input.setAttribute("autocomplete","off"),e.input.setAttribute("spellcheck","false");let l={name:"/",type:"dir",children:{home:{type:"dir",children:{guest:{type:"dir",children:{"about.txt":{type:"file",content:"Junior Implementation Specialist. .NET Enthusiast."},"skills.md":{type:"file",content:"C# | Unity | SQL | Git | Linux | Cybersecurity"},projects:{type:"dir",children:{"NetSentry.log":{type:"file",content:"System monitoring... [OK]"},"readme.txt":{type:"file",content:"Check the visual section for more info."}}},"contact.info":{type:"file",content:"Email: paweltrojanski@gmail.com | LinkedIn: /in/ptrojanski"},"cv.pdf":{type:"binary",content:"Binary file."}}}}},bin:{type:"dir",children:{}},etc:{type:"dir",children:{}}}},a={currentPath:["home","guest"],history:[],historyIndex:-1,currentUser:"guest"},o=e=>{let t=l;for(let r of e){if(!t.children||!t.children[r])return null;t=t.children[r]}return t},s=e=>{if(!e)return[...a.currentPath];let t=e.startsWith("/")?[]:[...a.currentPath],r=e.split("/");for(let n of r)if(""!==n&&"."!==n){if(".."===n)t.length>0&&t.pop();else{let i=o(t);if(!i||!i.children||!i.children[n]||"dir"!==i.children[n].type)return null;t.push(n)}}return t},d=()=>{let e="~"+(a.currentPath.length>2?"/"+a.currentPath.slice(2).join("/"):"");i.innerHTML=`<span style="color:var(--term-prompt-brackets);">[</span><span style="color:var(--accent);">${a.currentUser}@ptrojanski</span> <span style="color:var(--term-path);">${e}</span><span style="color:var(--term-prompt-brackets);">]$</span>`};d();let p={help(e){if(e.length>1)return"usage: help [command]";if(1===e.length){let t=e[0].toLowerCase();return({ls:"Usage: ls [-l] [-a] [dir]<br>List information about the FILEs.",cd:"Usage: cd [dir]<br>Change the shell working directory. Supports relative paths.",cat:"Usage: cat [file]<br>Concatenate FILE(s) to standard output.",open:"Usage: open [file]<br>Open a file in the default application.",mkdir:"Usage: mkdir [name]<br>Create the DIRECTORY(ies).",touch:"Usage: touch [name]<br>Create empty file.",rm:"Usage: rm [name]<br>Remove the FILE(s).",reboot:"Usage: reboot<br>Restart the system.",whoami:"Usage: whoami<br>Print current user.",matrix:"Usage: matrix<br>Enter the Matrix.",color:"Usage: color [name|hex]<br>Change system accent color.",clear:"Usage: clear<br>Clear screen."})[t]||`No manual entry for ${t}`}return`
                  <div style="margin-bottom: 5px; color:var(--term-text);">Available commands:</div>
                  <div style="display: grid; grid-template-columns: 80px auto; gap: 5px; color: var(--term-text-dim);">
                      <div><span style="color:var(--term-text)">ls</span></div>      <div>List directory contents</div>
                      <div><span style="color:var(--term-text)">cd</span></div>      <div>Change directory</div>
                      <div><span style="color:var(--term-text)">cat</span></div>     <div>Read text file</div>
                      <div><span style="color:var(--term-text)">open</span></div>    <div>Open file (PDF, links)</div>
                      <div><span style="color:var(--term-text)">mkdir</span></div>   <div>Create directory</div>
                      <div><span style="color:var(--term-text)">touch</span></div>   <div>Create file</div>
                      <div><span style="color:var(--term-text)">rm</span></div>      <div>Remove file</div>
                      <div><span style="color:var(--term-text)">echo</span></div>    <div>Print text / write to file</div>
                      <div><span style="color:var(--term-text)">whoami</span></div>  <div>Display current user</div>
                      <div><span style="color:var(--term-text)">color</span></div>   <div>Change system accent</div>
                      <div><span style="color:var(--term-text)">matrix</span></div>  <div>Enter the Matrix</div>
                      <div><span style="color:var(--term-text)">reboot</span></div>  <div>Restart system</div>
                      <div><span style="color:var(--term-text)">clear</span></div>   <div>Clear terminal</div>
                      <div><span style="color:var(--term-text)">exit</span></div>    <div>Close terminal</div>
                  </div>
                  <div style="margin-top: 10px; color: var(--term-gray);">Type <span style="color:var(--term-text)">help [command]</span> for details.</div>
                  `},ls(e){let t=e.filter(e=>e.startsWith("-")),r=e.filter(e=>!e.startsWith("-"));if(r.length>1)return"ls: too many arguments";let n=a.currentPath,i="";if(1===r.length){let l=s(r[0]);if(!l)return`ls: cannot access '${r[0]}': No such file or directory`;n=l,i=r[0]}let d=o(n);if(!d||!d.children)return"";let p=t.includes("-a")||t.includes("-la"),c=t.includes("-l")||t.includes("-la"),h=Object.entries(d.children).map(([e,t])=>{if(e.startsWith(".")&&!p)return null;let r="var(--term-text-dim)";"dir"===t.type&&(r="var(--term-dir)"),(e.endsWith(".pdf")||e.endsWith(".zip"))&&(r="var(--term-error)");let n="dir"===t.type?"/":"",i=`color:${r}; font-weight:${"dir"===t.type?"bold":"normal"};`;return c?`<div class="ls-row" style="color:var(--term-text-dim);"><span style="margin-right:10px">${"dir"===t.type?"drwxr-xr-x":"-rw-r--r--"}</span> <span style="margin-right:10px">guest</span> <span style="margin-right:10px">${Math.floor(4096*Math.random())}</span> <span style="${i}">${e}${n}</span></div>`:`<span style="${i} margin-right:15px;">${e}${n}</span>`}).filter(Boolean);return c?h.join(""):`<div style="display:flex; flex-wrap:wrap;">${h.join("")}</div>`},cd(e){if(e.length>1)return"cd: too many arguments";let t=e[0];if(!t||"~"===t)return a.currentPath=["home","guest"],d(),"";let r=s(t);return r?(a.currentPath=r,d(),""):`cd: ${t}: No such directory`},cat(e){if(1!==e.length)return"usage: cat [file]";let t=e[0],r=o(a.currentPath);return r.children&&r.children[t]?"dir"===r.children[t].type?`cat: ${t}: Is a directory`:"binary"===r.children[t].type?`cat: ${t}: Cannot read binary file. Use <span style="color:var(--term-text); font-weight:bold;">open ${t}</span> to view it.`:`<span style="color:var(--term-text);">${r.children[t].content}</span>`:`cat: ${t}: No such file`},open(e){if(1!==e.length)return"usage: open [file | url]";let t=e[0];if(t.startsWith("http://")||t.startsWith("https://")||t.startsWith("www.")){let r=t;return t.startsWith("www.")&&(r="https://"+t),window.open(r,"_blank"),`Opening external link: ${r}...`}let n=o(a.currentPath);return n.children[t]?"dir"===n.children[t].type?`open: ${t}: Is a directory`:"cv.pdf"===t?(window.open("./assets/files/cv.pdf","_blank"),"Opening CV..."):`open: ${t}: This is a text file. Use <span style="color:var(--term-text); font-weight:bold;">cat ${t}</span> to read it.`:`open: ${t}: No such file or directory`},mkdir(e){if(1!==e.length)return"usage: mkdir [name]";let t=o(a.currentPath);return t.children[e[0]]?`mkdir: cannot create directory '${e[0]}': File exists`:(t.children[e[0]]={type:"dir",children:{}},"")},touch(e){if(1!==e.length)return"usage: touch [name]";let t=o(a.currentPath);return t.children[e[0]]||(t.children[e[0]]={type:"file",content:""}),""},rm(e){if(0===e.length)return"usage: rm [name]";let t=e.filter(e=>!e.startsWith("-"))[0];if(!t)return"usage: rm [name]";if("/"===t&&e.includes("-rf"))return u("KERNEL PANIC"),"";let r=o(a.currentPath);return r.children[t]?(delete r.children[t],""):`rm: cannot remove '${t}': No such file`},echo(e,t){if(t.includes(">")){let r=t.split(">"),n=r[0].replace("echo","").trim().replace(/^['"]|['"]$/g,""),i=r[1].trim();return o(a.currentPath).children[i]={type:"file",content:n},""}return`<span style="color:var(--term-text);">${e.join(" ").replace(/^['"]|['"]$/g,"")}</span>`},color(e){let t={default:"#4ade80",green:"#4ade80",blue:"#3b82f6",red:"#ef4444",purple:"#a855f7",yellow:"#eab308",cyan:"#22d3ee",pink:"#f472b6",white:"#ffffff",orange:"#f97316"};if(0===e.length)return`Usage: color [name | hex]<br>Available presets:<br><div style="display:flex; flex-wrap:wrap; margin-top:5px;">${Object.keys(t).map(e=>`<span style="color:${t[e]}; margin-right:10px;">■ ${e}</span>`).join("")}</div><br>Or use hex: <span style="color:var(--term-text)">color #ff00ff</span>`;let r=e[0].toLowerCase();if(t[r])return document.body.style.setProperty("--accent",t[r]),`Color changed to <span style="color:${t[r]}">${r}</span>.`;if(/^#?([0-9A-F]{3}){1,2}$/i.test(r)){let n=r.startsWith("#")?r:"#"+r;return document.body.style.setProperty("--accent",n),`Color changed to <span style="color:${n}">custom hex</span>.`}return`color: invalid color or hex '${r}'`},whoami:e=>e.length>0?`whoami: extra operand '${e[0]}'`:`
                <pre style="font-size: 0.5rem; line-height: 1; color: var(--accent); margin-bottom: 10px; margin-top: 5px;">
     ██████╗  █████╗ ██╗    ██╗███████╗██╗
     ██╔══██╗██╔══██╗██║    ██║██╔════╝██║
     ██████╔╝███████║██║ █╗ ██║█████╗  ██║
     ██╔═══╝ ██╔══██║██║███╗██║██╔══╝  ██║
     ██║     ██║  ██║╚███╔███╔╝███████╗███████╗
     ╚═╝     ╚═╝  ╚═╝ ╚══╝╚══╝ ╚══════╝╚══════╝

     ████████╗██████╗  ██████╗       ██╗ █████╗ ███╗   ██╗███████╗██╗  ██╗██╗
     ╚══██╔══╝██╔══██╗██╔═══██╗     ██║██╔══██╗████╗  ██║██╔════╝██║ ██╔╝██║
        ██║   ██████╔╝██║   ██║     ██║███████║██╔██╗ ██║███████╗█████╔╝ ██║
        ██║   ██╔══██╗██║   ██║██   ██║██╔══██╗██║╚██╗██║╚════██║██╔═██╗ ██║
        ██║   ██║  ██║╚██████╔╝╚█████╔╝██║  ██║██║ ╚████║███████║██║  ██╗██║
        ╚═╝   ╚═╝  ╚═╝ ╚═════╝  ╚════╝ ╚═╝  ╚═╝╚═╝  ╚═══╝╚══════╝╚═╝  ╚═╝╚═╝
                </pre>
                <div style="color:var(--term-text-dim);">
                  User: <strong style="color:var(--term-text);">Paweł Trojański</strong> (root)<br>
                  Role: Implementation Spec & .NET Dev
                </div>`,matrix:t=>t.length>0?`matrix: extra operand '${t[0]}'`:(function t(r){let n=e.canvas;if(!n)return;let i=n.getContext("2d");r.classList.add("hidden-terminal"),n.style.display="block",n.width=window.innerWidth,n.height=window.innerHeight;let l=n.width/16,a=[];for(let o=0;o<l;o++)a[o]=1;let s=setInterval(()=>{i.fillStyle="rgba(0, 0, 0, 0.05)",i.fillRect(0,0,n.width,n.height),i.fillStyle="#0F0",i.font="16px monospace",i.textAlign="start";for(let e=0;e<a.length;e++){let t="01".charAt(Math.floor(2*Math.random()));i.fillText(t,16*e,16*a[e]),16*a[e]>n.height&&Math.random()>.975&&(a[e]=0),a[e]++}},33),d=()=>{clearInterval(s),n.style.display="none",r.classList.remove("hidden-terminal"),e.input.focus(),n.removeEventListener("click",d)};n.addEventListener("click",d)}(e.overlay),"Wake up..."),exit:t=>t.length>0?"exit: too many arguments":(e.overlay.classList.add("hidden-terminal"),""),reboot:e=>e.length>0?`reboot: extra operand '${e[0]}'`:(u("System Rebooting"),""),clear:e=>e.length>0?"clear: too many arguments":(t.innerHTML="",null)};e.input.addEventListener("keydown",r=>{if(("ArrowUp"===r.key||"ArrowDown"===r.key)&&r.preventDefault(),"Enter"===r.key){var n;r.preventDefault();let i=e.input.value,l=i.trim().split(/\s+/),o=l.shift().toLowerCase();""!==i.trim()&&(a.history.push(i),a.historyIndex=a.history.length);let s=`<span style="color:var(--term-history);">[</span><span style="color:var(--term-history);">${a.currentUser}@ptrojanski</span> <span style="color:var(--term-history);">${"~"+(a.currentPath.length>2?"/"+a.currentPath.slice(2).join("/"):"")}</span><span style="color:var(--term-history);">]$</span>`,d=document.createElement("div");if(d.innerHTML=`${s} <span style="color:var(--term-history);">${(n=i).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}</span>`,t.appendChild(d),p[o]){let c=p[o](l,i);if(null!==c&&""!==c){let h=document.createElement("div");h.className="term-response",h.style.color="var(--term-text-dim)",h.style.marginBottom="5px",h.innerHTML=c,t.appendChild(h)}}else if(""!==o){let m=document.createElement("div");m.style.color="var(--term-error)",m.textContent=`bash: ${o}: command not found`,t.appendChild(m)}e.input.value="",e.body.scrollTop=e.body.scrollHeight}else"ArrowUp"===r.key?a.historyIndex>0&&(a.historyIndex--,e.input.value=a.history[a.historyIndex]):"ArrowDown"===r.key&&(a.historyIndex<a.history.length-1?(a.historyIndex++,e.input.value=a.history[a.historyIndex]):(a.historyIndex=a.history.length,e.input.value=""))}),e.toggleBtn.addEventListener("click",t=>{t.preventDefault(),e.overlay.classList.toggle("hidden-terminal"),e.overlay.classList.contains("hidden-terminal")||setTimeout(()=>e.input.focus(),100)}),e.closeBtn.addEventListener("click",t=>{t.stopPropagation(),e.overlay.classList.add("hidden-terminal")}),e.body.addEventListener("click",()=>e.input.focus());let c=!1,h,m,y,v;function u(t){let r=e.canvas;if(!r){location.reload();return}e.overlay.classList.add("hidden-terminal"),r.style.display="block",r.width=window.innerWidth,r.height=window.innerHeight;let n=r.getContext("2d"),i=0,l=setInterval(()=>{n.fillStyle="#000",n.fillRect(0,0,r.width,r.height),n.fillStyle="#0F0",n.font="30px monospace",n.textAlign="center",n.textBaseline="middle";let e=t+".".repeat(i);n.fillText(e,r.width/2,r.height/2),i=(i+1)%4},500);setTimeout(()=>{clearInterval(l),location.reload()},2400)}e.header.addEventListener("mousedown",t=>{if(t.target===e.closeBtn||e.closeBtn.contains(t.target))return;c=!0,h=t.clientX,m=t.clientY;let r=e.overlay.getBoundingClientRect();y=r.left,v=r.top,e.overlay.style.transform="none",e.overlay.style.left=`${y}px`,e.overlay.style.top=`${v}px`}),document.addEventListener("mousemove",t=>{c&&(e.overlay.style.left=`${y+(t.clientX-h)}px`,e.overlay.style.top=`${v+(t.clientY-m)}px`)}),document.addEventListener("mouseup",()=>c=!1)}